<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#005EB8">
    <title>Midwife Companion</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">

    <style>
        /* === NHS STYLE THEME === */
        :root {
            --nhs-blue: #005EB8;
            --nhs-dark-blue: #003087;
            --nhs-green: #009639;
            --nhs-warm-yellow: #FFB81C;
            --nhs-grey-1: #4C6272;
            --nhs-grey-5: #F0F4F5;
            --card-border: #d8dde0;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--nhs-grey-5);
            margin: 0;
            padding-bottom: 80px;
            color: #231f20;
            -webkit-tap-highlight-color: transparent;
        }

        /* HEADER */
        .header {
            background-color: var(--nhs-blue);
            color: var(--white);
            padding: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 { margin: 0; font-size: 1.25rem; font-weight: 700; }
        .nhs-logo { font-weight: 800; font-style: italic; border: 2px solid white; padding: 0 4px; font-size: 1.2rem; }

        /* CONTAINER */
        .container { max-width: 600px; margin: 0 auto; padding: 16px; }

        /* CARDS */
        .card {
            background: var(--white);
            border: 1px solid var(--card-border);
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 0 rgba(0,0,0,0.05);
        }

        h2 {
            margin-top: 0; color: var(--nhs-blue); font-size: 1.5rem;
            border-bottom: 1px solid var(--card-border); padding-bottom: 12px; margin-bottom: 20px;
        }

        /* FORMS */
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--nhs-grey-1); }

        input[type="date"], input[type="number"], input[type="text"], select {
            width: 100%; padding: 10px; font-size: 16px;
            border: 2px solid var(--nhs-grey-1); border-radius: 4px;
            box-sizing: border-box; margin-bottom: 16px; background-color: var(--white);
        }

        input:focus, select:focus { outline: 3px solid var(--nhs-warm-yellow); border-color: var(--nhs-blue); }

        /* BUTTONS */
        .btn {
            background-color: var(--nhs-green); color: var(--white); border: none;
            padding: 12px 24px; font-size: 1rem; font-weight: 600; border-radius: 4px;
            cursor: pointer; width: 100%; text-align: center; box-shadow: 0 4px 0 #006627;
        }
        .btn:active { box-shadow: none; transform: translateY(4px); }

        /* RESULTS & DATA */
        .result-box {
            margin-top: 16px; padding: 16px; background-color: #e6f3fa;
            border-left: 8px solid var(--nhs-blue); display: none;
        }
        .result-value { font-size: 1.25rem; font-weight: bold; color: var(--nhs-dark-blue); }

        /* MED LIST STYLES */
        .med-item { padding: 12px 0; border-bottom: 1px solid #eee; }
        .med-item:last-child { border-bottom: none; }
        .med-name { color: var(--nhs-blue); font-weight: bold; font-size: 1.1rem; }
        .med-desc { color: #444; font-size: 0.95rem; margin-top: 4px; }
        .med-tag { 
            display: inline-block; background: #eee; color: #555; 
            font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; margin-top: 4px; 
        }

        /* BOTTOM NAV */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: var(--white);
            border-top: 1px solid var(--card-border); display: flex;
            justify-content: space-around; padding: 10px 0; z-index: 100;
        }
        .nav-item { text-align: center; font-size: 0.8rem; color: var(--nhs-blue); cursor: pointer; flex: 1; }
        .nav-item.active { font-weight: bold; border-bottom: 3px solid var(--nhs-blue); margin-bottom: -10px; padding-bottom: 7px; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* OFFLINE BANNER */
        #offline-status {
            background: var(--nhs-warm-yellow); color: #000; text-align: center;
            padding: 5px; font-size: 0.8rem; font-weight: bold; display: none;
        }
    </style>
</head>
<body>

    <header class="header">
        <h1>Midwife Companion</h1>
        <div class="nhs-logo">NHS</div>
    </header>
    
    <div id="offline-status">You are currently offline.</div>

    <div class="container">

        <div id="tab-edd" class="tab-content active">
            <div class="card">
                <h2>EDD Calculator</h2>
                <label for="lmp">First day of LMP</label>
                <input type="date" id="lmp">
                <label for="cycle">Cycle Length (Days)</label>
                <input type="number" id="cycle" value="28" placeholder="28">
                <button class="btn" onclick="calculateEDD()">Calculate Date</button>
                <div id="edd-result" class="result-box">
                    <div>Estimated Due Date:</div>
                    <div class="result-value" id="edd-date-display">--/--/----</div>
                    <div style="font-size: 0.9rem; margin-top:5px;">Gestational Age: <span id="gestation-display">0 weeks</span></div>
                </div>
            </div>
        </div>

        <div id="tab-bishop" class="tab-content">
            <div class="card">
                <h2>Bishop Score</h2>
                <label>Dilation (cm)</label>
                <select id="bish-dilation">
                    <option value="0">Closed (0)</option>
                    <option value="1">1-2 cm (1)</option>
                    <option value="2">3-4 cm (2)</option>
                    <option value="3">5+ cm (3)</option>
                </select>
                <label>Effacement</label>
                <select id="bish-efface">
                    <option value="0">0-30% (0)</option>
                    <option value="1">40-50% (1)</option>
                    <option value="2">60-70% (2)</option>
                    <option value="3">80%+ (3)</option>
                </select>
                <label>Station</label>
                <select id="bish-station">
                    <option value="0">-3 (0)</option>
                    <option value="1">-2 (1)</option>
                    <option value="2">-1 / 0 (2)</option>
                    <option value="3">+1 / +2 (3)</option>
                </select>
                <label>Cervical Consistency</label>
                <select id="bish-consist">
                    <option value="0">Firm (0)</option>
                    <option value="1">Medium (1)</option>
                    <option value="2">Soft (2)</option>
                </select>
                <label>Cervical Position</label>
                <select id="bish-pos">
                    <option value="0">Posterior (0)</option>
                    <option value="1">Mid-position (1)</option>
                    <option value="2">Anterior (2)</option>
                </select>
                <button class="btn" onclick="calculateBishop()">Calculate Score</button>
                <div id="bishop-result" class="result-box">
                    <div>Total Score:</div>
                    <div class="result-value" id="bishop-score-display">0</div>
                    <div id="bishop-interp" style="margin-top: 5px; font-style: italic;"></div>
                </div>
            </div>
        </div>

        <div id="tab-meds" class="tab-content">
            <div class="card">
                <h2>Medication Index</h2>
                <input type="text" id="med-search" onkeyup="filterMeds()" placeholder="Search drugs (e.g. 'PPH', 'Pain')...">
                
                <div id="med-list">
                    <div class="med-item">
                        <div class="med-name">Entonox</div>
                        <div class="med-desc">Inhalation analgesia (Nitrous Oxide/Oxygen). Rapid onset/offset.</div>
                        <div class="med-tag">Pain Relief</div>
                    </div>
                    <div class="med-item">
                        <div class="med-name">Pethidine</div>
                        <div class="med-desc">Opioid analgesic (IM). Can cause neonatal respiratory depression.</div>
                        <div class="med-tag">Pain Relief</div>
                    </div>
                    <div class="med-item">
                        <div class="med-name">Diamorphine</div>
                        <div class="med-desc">Opioid analgesic (IM/IV). Stronger than Pethidine.</div>
                        <div class="med-tag">Pain Relief</div>
                    </div>
                    
                    <div class="med-item">
                        <div class="med-name">Syntometrine</div>
                        <div class="med-desc">IM injection for Active Management of 3rd Stage. (Oxytocin + Ergometrine). Avoid in hypertension.</div>
                        <div class="med-tag">Third Stage</div>
                    </div>
                    <div class="med-item">
                        <div class="med-name">Syntocinon (Oxytocin)</div>
                        <div class="med-desc">IV infusion for IOL/Augmentation. IM/IV for 3rd Stage or PPH.</div>
                        <div class="med-tag">Induction</div> <div class="med-tag">PPH</div>
                    </div>
                    <div class="med-item">
                        <div class="med-name">Ergometrine</div>
                        <div class="med-desc">IM/IV for PPH management. Causes strong sustained contraction.</div>
                        <div class="med-tag">PPH</div>
                    </div>
                    <div class="med-item">
                        <div class="med-name">Carboprost</div>
                        <div class="med-desc">Deep IM for severe PPH when other measures fail. Caution in asthma.</div>
                        <div class="med-tag">PPH</div>
                    </div>
                    <div class="med-item">
                        <div class="med-name">Misoprostol</div>
                        <div class="med-desc">Rectal/Sublingual for PPH. Vaginal/Oral for IOL.</div>
                        <div class="med-tag">PPH</div> <div class="med-tag">Induction</div>
                    </div>

                    <div class="med-item">
                        <div class="med-name">Vitamin K (Konakion)</div>
                        <div class="med-desc">IM or Oral. Prevention of Vitamin K Deficiency Bleeding (VKDB).</div>
                        <div class="med-tag">Neonatal</div>
                    </div>
                    <div class="med-item">
                        <div class="med-name">Anti-D Immunoglobulin</div>
                        <div class="med-desc">IM injection for RhD negative women to prevent Rhesus isoimmunisation.</div>
                        <div class="med-tag">Antenatal</div> <div class="med-tag">Postnatal</div>
                    </div>
                    <div class="med-item">
                        <div class="med-name">Lidocaine</div>
                        <div class="med-desc">Local anaesthetic for perineal infiltration (suturing/episiotomy).</div>
                        <div class="med-tag">Perineal Repair</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-ref" class="tab-content">
            <div class="card">
                <h2>Neonatal Vitals (Term)</h2>
                <table class="ref-table">
                    <tr><th>Vital</th><th>Normal Range</th></tr>
                    <tr><td>Heart Rate</td><td>110 - 160 bpm</td></tr>
                    <tr><td>Resp. Rate</td><td>30 - 60 bpm</td></tr>
                    <tr><td>Temp (Axilla)</td><td>36.5 - 37.4 Â°C</td></tr>
                    <tr><td>Blood Glucose</td><td>> 2.6 mmol/L</td></tr>
                </table>
            </div>
        </div>

    </div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="switchTab('edd', this)">EDD</div>
        <div class="nav-item" onclick="switchTab('bishop', this)">Bishop</div>
        <div class="nav-item" onclick="switchTab('meds', this)">Meds</div>
        <div class="nav-item" onclick="switchTab('ref', this)">Ref</div>
    </nav>

    <script>
        // APP LOGIC
        function switchTab(tabName, element) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            element.classList.add('active');
        }

        // MEDICATION FILTER
        function filterMeds() {
            const input = document.getElementById('med-search');
            const filter = input.value.toUpperCase();
            const list = document.getElementById('med-list');
            const items = list.getElementsByClassName('med-item');

            for (let i = 0; i < items.length; i++) {
                const txtValue = items[i].textContent || items[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    items[i].style.display = "";
                } else {
                    items[i].style.display = "none";
                }
            }
        }

        // CALCULATOR LOGIC (Same as before)
        function calculateEDD() {
            const lmpInput = document.getElementById('lmp').value;
            const cycleLength = parseInt(document.getElementById('cycle').value) || 28;
            if (!lmpInput) { alert("Please select an LMP date."); return; }
            const lmp = new Date(lmpInput);
            const cycleAdjustment = cycleLength - 28;
            const daysToAdd = 280 + cycleAdjustment;
            const edd = new Date(lmp);
            edd.setDate(edd.getDate() + daysToAdd);
            
            const today = new Date();
            const diffTime = Math.abs(today - lmp);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            const weeks = Math.floor(diffDays / 7);
            const days = diffDays % 7;

            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            document.getElementById('edd-date-display').innerText = edd.toLocaleDateString('en-GB', options);
            document.getElementById('gestation-display').innerText = `${weeks} weeks + ${days} days`;
            document.getElementById('edd-result').style.display = 'block';
        }

        function calculateBishop() {
            const ids = ['bish-dilation', 'bish-efface', 'bish-station', 'bish-consist', 'bish-pos'];
            let score = 0;
            ids.forEach(id => score += parseInt(document.getElementById(id).value));
            
            let interpretation = "";
            if (score <= 5) interpretation = "Unfavourable cervix (Induction likely required)";
            else if (score >= 6) interpretation = "Favourable cervix";

            document.getElementById('bishop-score-display').innerText = score;
            document.getElementById('bishop-interp').innerText = interpretation;
            document.getElementById('bishop-result').style.display = 'block';
        }

        // SERVICE WORKER REGISTRATION
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered'))
                    .catch(err => console.log('SW Fail', err));
            });
        }
        window.addEventListener('offline', () => { document.getElementById('offline-status').style.display = 'block'; });
        window.addEventListener('online', () => { document.getElementById('offline-status').style.display = 'none'; });
    </script>
</body>
</html>
